+++
title = 'What happens before main()'
+++

# What happens before main()
Lots of things:
1. Loaded calls preinitarray, then `_start`
2. That calls `__libc_start_main`, which calls `__libc_csu_init`, which calls a bunch of other stuff
3. After that, `__libc_start_main` calls `main`
4. And then `exit` happens

## Start at `_start`
- often if you have `%ebp`, `%esi`, etc. and relatively small addresses, probably a 32-bit binary (stack used for argument passing)
- `argc` popped into `%esi`
- `argv` moved from to `%ecx`
- stack pointer aligned to boundary
- push arguments and call `__libc_start_main`
    - this calls `__libc_init_first`, retrieving global variable `__environ`

## `__libc_start_main`
- handles security stuff for setuid/setgid
- starts threading
- registers `fini` and `rtld_fini` arguments to run via `at_exit` for cleanup
- calls `init` argument
- calls `main` with `argc` and `argv`
- calls `exit` with return value of main

## `__libc_csu_init`
- the constructor of the program
- calls `_init()`
- calls array of function calls with `argc`, `argv`, and `envp`

## `_init`
- does a bunch of stuff, including global constructors (e.g. constructors for static C++ objects)

## `exit`
- runs functions registered with `atexit()` (in reverse order of registration)
- runs all functions in `fini_array`
- runs destructors



